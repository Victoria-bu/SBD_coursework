<!DOCTYPE html>
<html>
<head>
    <title>–î–æ–∫—É–º–µ–Ω—Ç –ñ–ï–ö—É</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã –î–æ–∫—É–º–µ–Ω—Ç –∂–∏—Ç–ª–æ–≤–æ-–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ–π–Ω–æ–≥–æ –≤—ñ–¥–¥—ñ–ª—É</h1>
            <p>–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º–µ—à–∫–∞–Ω—Ü—ñ–≤: {{ streets_data | sum(attribute='total_tenants') }}</p>
        </div>

        <div class="navbar">
            <a href="{{ url_for('tenants') }}">üìã –ú–µ—à–∫–∞–Ω—Ü—ñ</a>
            <a href="{{ url_for('district_report') }}">üèòÔ∏è –î–æ–∫—É–º–µ–Ω—Ç –ñ–ï–ö—É</a>
            <a href="{{ url_for('add_tenant') }}">‚ûï –î–æ–¥–∞—Ç–∏ –º–µ—à–∫–∞–Ω—Ü—è</a>
            <a href="{{ url_for('add_address') }}">üè† –î–æ–¥–∞—Ç–∏ –∞–¥—Ä–µ—Å—É</a>
            <span class="user-info">üö™ {{ current_user.username }}</span>
            <a href="{{ url_for('logout') }}" style="float: right;">–í–∏–π—Ç–∏</a>
        </div>

        <div class="sort-controls">
            <label>–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</label>
            <select onchange="sortStreets(this.value)">
                <option value="name_asc">–í—É–ª–∏—Ü—ñ –ê-–Ø</option>
                <option value="name_desc">–í—É–ª–∏—Ü—ñ –Ø-–ê</option>
                <option value="tenants_asc">–ú–µ–Ω—à–µ –º–µ—à–∫–∞–Ω—Ü—ñ–≤</option>
                <option value="tenants_desc">–ë—ñ–ª—å—à–µ –º–µ—à–∫–∞–Ω—Ü—ñ–≤</option>
            </select>
            
            <label>–§—ñ–ª—å—Ç—Ä:</label>
            <select onchange="filterOccupancy(this.value)">
                <option value="all">–í—Å—ñ –∫–≤–∞—Ä—Ç–∏—Ä–∏</option>
                <option value="occupied">–ó–∞—Å–µ–ª–µ–Ω—ñ</option>
                <option value="vacant">–í—ñ–ª—å–Ω—ñ</option>
            </select>
        </div>

        {% for street_info in streets_data %}
        <div class="street-section" data-street="{{ street_info.street.name }}" data-tenants="{{ street_info.total_tenants }}">
            <h2 class="street-header">
                üìç –í–£–õ–ò–¶–Ø: {{ street_info.street.name }}
                <small style="float: right; font-size: 14px;">–ú–µ—à–∫–∞–Ω—Ü—ñ–≤: {{ street_info.total_tenants }}</small>
            </h2>
            
            {% for building_info in street_info.buildings %}
            <div class="building-section">
                <h3 class="building-header">üè† –ë—É–¥–∏–Ω–æ–∫ ‚Ññ{{ building_info.building.number }}</h3>
                
                <table class="apartments-table">
                    <thead>
                        <tr>
                            <th>–ö–≤–∞—Ä—Ç–∏—Ä–∞</th>
                            <th>–ü–ª–æ—â–∞</th>
                            <th>–ö—ñ–º–Ω–∞—Ç</th>
                            <th>–¢–∏–ø –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ</th>
                            <th>–ú–µ—à–∫–∞–Ω—Ü—ñ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for apartment_info in building_info.apartments %}
                        <tr class="apartment-row" data-occupied="{{ apartment_info.tenants | length > 0 }}">
                            <td><strong>{{ apartment_info.apartment.number }}</strong></td>
                            <td>
                                <span class="area-badge">{{ apartment_info.apartment.area }} –º¬≤</span>
                            </td>
                            <td>
                                {% if apartment_info.apartment.rooms %}
                                <span class="rooms-badge">{{ apartment_info.apartment.rooms }} –∫—ñ–º.</span>
                                {% else %}
                                <span>-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% set ownership_class = {
                                    '–ø—Ä–∏–≤–∞—Ç–Ω–∞': 'ownership-private',
                                    '–∫–æ–º—É–Ω–∞–ª—å–Ω–∞': 'ownership-municipal', 
                                    '–æ—Ä–µ–Ω–¥–Ω–∞': 'ownership-rental',
                                    '–∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞': 'ownership-cooperative'
                                } %}
                                <span class="ownership-badge {{ ownership_class.get(apartment_info.apartment.ownership_type, '') }}">
                                    {{ apartment_info.apartment.ownership_type }}
                                </span>
                            </td>
                            <td>
                                {% for tenant in apartment_info.tenants %}
                                    <div class="status-occupied">{{ tenant.full_name }}</div>
                                {% else %}
                                    <div class="status-vacant">–í—ñ–ª—å–Ω–∞</div>
                                {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <script>
        function sortStreets(sortType) {
            const streetsContainer = document.querySelector('.container');
            const streetSections = Array.from(document.querySelectorAll('.street-section'));
            
            streetSections.sort((a, b) => {
                const streetA = a.getAttribute('data-street');
                const streetB = b.getAttribute('data-street');
                const tenantsA = parseInt(a.getAttribute('data-tenants'));
                const tenantsB = parseInt(b.getAttribute('data-tenants'));
                
                switch(sortType) {
                    case 'name_asc':
                        return streetA.localeCompare(streetB);
                    case 'name_desc':
                        return streetB.localeCompare(streetA);
                    case 'tenants_asc':
                        return tenantsA - tenantsB;
                    case 'tenants_desc':
                        return tenantsB - tenantsA;
                    default:
                        return 0;
                }
            });
            
            // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
            streetSections.forEach(section => section.remove());
            
            // –î–æ–¥–∞—î–º–æ –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ —Å–µ–∫—Ü—ñ—ó
            streetSections.forEach(section => streetsContainer.appendChild(section));
        }
        
        function filterOccupancy(filterType) {
            const rows = document.querySelectorAll('.apartment-row');
            
            rows.forEach(row => {
                const isOccupied = row.getAttribute('data-occupied') === 'true';
                
                switch(filterType) {
                    case 'all':
                        row.style.display = '';
                        break;
                    case 'occupied':
                        row.style.display = isOccupied ? '' : 'none';
                        break;
                    case 'vacant':
                        row.style.display = isOccupied ? 'none' : '';
                        break;
                }
            });
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        document.addEventListener('DOMContentLoaded', function() {
            sortStreets('name_asc');
        });
    </script>
</body>
</html>