<!DOCTYPE html>
<html>
<head>
    <title>District Office Document</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ District Housing Maintenance Department Document</h1>
            <p>Total number of tenants: {{ streets_data | sum(attribute='total_tenants') }}</p>
        </div>

        <div class="navbar">
            <a href="{{ url_for('tenants.tenants_list') }}">ğŸ“‹ Tenants</a>
            <a href="{{ url_for('documents.district_report') }}">ğŸ˜ï¸ District Office Document</a>
            <a href="{{ url_for('tenants.add_tenant') }}">â• Add Tenant</a>
            <a href="{{ url_for('addresses.add_address') }}">ğŸ  Add Address</a>
            <span class="user-info">ğŸšª {{ current_user.username }}</span>
            <a href="{{ url_for('auth.logout') }}" style="float: right;">Logout</a>
        </div>

        <div class="sort-controls">
            <label>Sort:</label>
            <select onchange="sortStreets(this.value)">
                <option value="name_asc">Streets Aâ€“Z</option>
                <option value="name_desc">Streets Zâ€“A</option>
                <option value="tenants_asc">Fewer tenants</option>
                <option value="tenants_desc">More tenants</option>
            </select>

            <label>Filter:</label>
            <select onchange="filterOccupancy(this.value)">
                <option value="all">All apartments</option>
                <option value="occupied">Occupied</option>
                <option value="vacant">Vacant</option>
            </select>
        </div>

        {% for street_info in streets_data %}
        <div class="street-section" 
             data-street="{{ street_info.street.name }}" 
             data-tenants="{{ street_info.total_tenants }}">

            <h2 class="street-header">
                ğŸ“ STREET: {{ street_info.street.name }}
                <small style="float: right; font-size: 14px;">
                    Tenants: {{ street_info.total_tenants }}
                </small>
            </h2>

            {% for building_info in street_info.buildings %}
            <div class="building-section">
                <h3 class="building-header">
                    ğŸ  Building â„–{{ building_info.building.number }}
                </h3>

                <table class="apartments-table">
                    <thead>
                        <tr>
                            <th>Apartment</th>
                            <th>Area</th>
                            <th>Rooms</th>
                            <th>Ownership Type</th>
                            <th>Tenants</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for apartment_info in building_info.apartments %}
                        <tr class="apartment-row" data-occupied="{{ apartment_info.tenants | length > 0 }}">
                            <td><strong>{{ apartment_info.apartment.number }}</strong></td>

                            <td>
                                <span class="area-badge">{{ apartment_info.apartment.area }} mÂ²</span>
                            </td>

                            <td>
                                {% if apartment_info.apartment.rooms %}
                                <span class="rooms-badge">{{ apartment_info.apartment.rooms }} rooms</span>
                                {% else %}
                                <span>-</span>
                                {% endif %}
                            </td>

                            <td>
                                {% set ownership_class = {
                                    'Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ°': 'ownership-private',
                                    'ĞºĞ¾Ğ¼ÑƒĞ½Ğ°Ğ»ÑŒĞ½Ğ°': 'ownership-municipal',
                                    'Ğ¾Ñ€ĞµĞ½Ğ´Ğ½Ğ°': 'ownership-rental',
                                    'ĞºĞ¾Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°': 'ownership-cooperative'
                                } %}
                                <span class="ownership-badge {{ ownership_class.get(apartment_info.apartment.ownership_type, '') }}">
                                    {{ apartment_info.apartment.ownership_type }}
                                </span>
                            </td>

                            <td>
                                {% for tenant in apartment_info.tenants %}
                                    <div class="status-occupied">{{ tenant.full_name }}</div>
                                {% else %}
                                    <div class="status-vacant">Vacant</div>
                                {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <script>
        function sortStreets(sortType) {
            const streetsContainer = document.querySelector('.container');
            const streetSections = Array.from(document.querySelectorAll('.street-section'));

            streetSections.sort((a, b) => {
                const streetA = a.getAttribute('data-street');
                const streetB = b.getAttribute('data-street');
                const tenantsA = parseInt(a.getAttribute('data-tenants'));
                const tenantsB = parseInt(b.getAttribute('data-tenants'));

                switch (sortType) {
                    case 'name_asc':
                        return streetA.localeCompare(streetB);
                    case 'name_desc':
                        return streetB.localeCompare(streetA);
                    case 'tenants_asc':
                        return tenantsA - tenantsB;
                    case 'tenants_desc':
                        return tenantsB - tenantsA;
                    default:
                        return 0;
                }
            });

            streetSections.forEach(section => section.remove());
            streetSections.forEach(section => streetsContainer.appendChild(section));
        }

        function filterOccupancy(filterType) {
            const rows = document.querySelectorAll('.apartment-row');

            rows.forEach(row => {
                const isOccupied = row.getAttribute('data-occupied') === 'true';

                switch (filterType) {
                    case 'all':
                        row.style.display = '';
                        break;
                    case 'occupied':
                        row.style.display = isOccupied ? '' : 'none';
                        break;
                    case 'vacant':
                        row.style.display = isOccupied ? 'none' : '';
                        break;
                }
            });
        }

        // Auto-sort on load
        document.addEventListener('DOMContentLoaded', function() {
            sortStreets('name_asc');
        });
    </script>
</body>
</html>
